##############################################################################
# ScaleIO prerequisites tasks
##############################################################################
- role: ['primary-controller', 'controller', 'compute', 'cinder']
  stage: post_deployment/2000
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/environment.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 360

##############################################################################
# ScaleIO installation tasks
##############################################################################
- role: ['primary-controller', 'controller']
  stage: post_deployment/2050
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/controller_server.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 1800

- role: ['primary-controller', 'controller', 'compute']
  stage: post_deployment/2050
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/sds_server.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 1800

- role: ['primary-controller', 'controller', 'compute']
  stage: post_deployment/2050
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/sdc_server.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 1800

##############################################################################
# ScaleIO cluster configuration tasks
##############################################################################
- role: ['primary-controller', 'controller']
  stage: post_deployment/2100
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/controller.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 600

- role: ['primary-controller']
  stage: post_deployment/2150
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/cluster.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 600

##############################################################################
# Openstack components (Cinder, Nova) configuration tasks
##############################################################################
- role: ['compute']
  stage: post_deployment/2200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/compute.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 600

- role: ['primary-controller', 'controller']
  stage: post_deployment/2200
  type: puppet
  parameters:
    puppet_manifest: puppet/manifests/cinder.pp
    puppet_modules: puppet/modules:/etc/puppet/modules
    timeout: 600

